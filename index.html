<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}

async function atualizarDolar() {
    try {
        const resposta = await fetch("https://economia.awesomeapi.com.br/json/last/USD-BRL");
        const dados = await resposta.json();
        let cotacao = parseFloat(dados.USDBRL.bid);
        let cotacaoFinal = cotacao * 1.099;
        document.getElementById("cotacao").value = cotacaoFinal.toFixed(4);
    } catch {
        alert("Erro ao buscar cotaÃ§Ã£o.");
    }
}

function calcular() {
    let valorUsd = parseFloat(document.getElementById("valorUsd").value);
    let peso = parseFloat(document.getElementById("peso").value);
    let cotacao = parseFloat(document.getElementById("cotacao").value);
    let quantidade = parseInt(document.getElementById("quantidade").value) || 1;

    if (!valorUsd || !peso || !cotacao) {
        alert("Preencha todos os campos.");
        return;
    }

    // ðŸ”¹ Produto e peso total
    let totalUsd = valorUsd * quantidade;
    let pesoTotal = peso * quantidade;

    let produtoReais = totalUsd * cotacao;

    // ðŸ”¹ Paraguay Box (25 USD por kg convertido)
    let paraguay = (pesoTotal / 1000) * 25 * cotacao;

    // ðŸ”¹ Freteiro sobre valor total
    let freteiro = (produtoReais * 0.25) + 100;

    let custo = produtoReais + paraguay + freteiro;

    let percentuais = [15,20,25,30,40,50];

    let html = `
        <div><b>Produto Total (${quantidade}x):</b> R$ ${produtoReais.toFixed(2)}</div>
        <div><b>Peso Total:</b> ${pesoTotal.toFixed(0)} g</div>
        <div><b>Paraguay Box:</b> R$ ${paraguay.toFixed(2)}</div>
        <div><b>Freteiro:</b> R$ ${freteiro.toFixed(2)}</div>
        <div class="valor-destaque"><b>Custo Total:</b> R$ ${custo.toFixed(2)}</div>
        <hr>
        <table class="tabela">
        <tr>
            <td><b>%</b></td>
            <td><b>Lucro</b></td>
            <td><b>Total</b></td>
            <td><b>UnitÃ¡rio</b></td>
        </tr>
    `;

    percentuais.forEach(p => {
        let lucro = custo * (p/100);
        let final = custo + lucro;
        let unitario = final / quantidade;

        html += `
            <tr>
                <td>${p}%</td>
                <td>R$ ${lucro.toFixed(2)}</td>
                <td class="valor-destaque">
                    R$ ${final.toFixed(2)}
                    <button class="btn-copy" onclick="copiarValor('${final.toFixed(2)}')">Copiar</button>
                </td>
                <td class="valor-destaque">
                    R$ ${unitario.toFixed(2)}
                </td>
            </tr>
        `;
    });

    html += "</table>";

    document.getElementById("resultado").style.display = "block";
    document.getElementById("resultado").innerHTML = html;
}

function copiarValor(valor) {
    navigator.clipboard.writeText("R$ " + valor);
    alert("Copiado: R$ " + valor);
}

function alternarModo() {
    document.body.classList.toggle("light-mode");
}

function limparTudo() {
    document.getElementById("valorUsd").value = "";
    document.getElementById("peso").value = "";
    document.getElementById("cotacao").value = "";
    document.getElementById("quantidade").value = "1";
    document.getElementById("resultado").style.display = "none";
}

window.onload = atualizarDolar;
</script>
