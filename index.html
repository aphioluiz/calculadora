<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora Importação AmpereRC</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">
<link rel="icon" type="image/png" href="icone.png">
<link rel="apple-touch-icon" href="icone.png">

<style>
* { box-sizing: border-box; }

:root {
    --bg: #0f172a;
    --card: #1e293b;
    --text: #ffffff;
    --accent: #22c55e;
    --result: #334155;
}

.light-mode {
    --bg: #f1f5f9;
    --card: #ffffff;
    --text: #0f172a;
    --accent: #16a34a;
    --result: #e2e8f0;
}

body {
    font-family: Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 20px;
    transition: 0.3s;
}

.container {
    max-width: 480px;
    margin: auto;
}

h1 {
    text-align: center;
    font-size: 22px;
    margin-bottom: 5px;
}

.by {
    display: block;
    font-size: 12px;
    font-weight: normal;
    text-align: right;
    opacity: 0.7;
    margin-top: 4px;
}

.card {
    background: var(--card);
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 15px;
}

input {
    width: 100%;
    padding: 10px;
    margin: 5px 0 10px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
}

input[type=range] {
    padding: 0;
}

button {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    color: white;
}

.btn-main { background: var(--accent); }
.btn-mode { background: #64748b; }
.btn-copy { background: #3b82f6; padding: 4px 8px; font-size: 12px; margin-left: 6px; }
.btn-clear { background: #ef4444; }

.resultado {
    background: var(--result);
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
}

.tabela {
    width: 100%;
    margin-top: 10px;
    border-collapse: collapse;
}

.tabela td {
    padding: 6px;
    border-bottom: 1px solid #9993;
    font-size: 14px;
}

.valor-destaque {
    font-weight: bold;
    color: var(--accent);
}
</style>
</head>

<body>

<div class="container">
    <h1>
        Calculadora Importação AmpereRC
        <span class="by">by Aphio</span>
    </h1>

    <div class="card">
        <label>Valor Produto (USD)</label>
        <input type="number" id="valorUsd" step="0.01">

        <label>Quantidade</label>
        <input type="number" id="quantidade" value="1" min="1">

        <label>Peso (gramas)</label>
        <input type="number" id="peso">

        <label>Cotação Dólar (automática x1,099)</label>
        <input type="number" id="cotacao" step="0.0001">

        <label>Margem de Lucro: <span id="lucroValor">20</span>%</label>
        <input type="range" id="lucroSlider" min="5" max="50" step="5" value="20" oninput="atualizarLucroValor(this.value)">

        <button class="btn-main" onclick="calcular()">Calcular</button>
        <button class="btn-main" onclick="atualizarDolar(true)">Atualizar Dólar</button>
        <button class="btn-clear" onclick="limparTudo()">Limpar Tudo</button>
        <button class="btn-mode" onclick="alternarModo()">Alternar Modo</button>
    </div>

    <div class="card resultado" id="resultado" style="display:none;"></div>
</div>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}

async function atualizarDolar(mostrarErro) {
    try {
        const resposta = await fetch("https://economia.awesomeapi.com.br/json/last/USD-BRL");
        const dados = await resposta.json();

        if (dados && dados.USDBRL && dados.USDBRL.bid) {
            var cotacao = parseFloat(dados.USDBRL.bid);
            var cotacaoFinal = cotacao * 1.099;
            document.getElementById("cotacao").value = cotacaoFinal.toFixed(4);
        } else {
            throw new Error("Formato inesperado");
        }

    } catch (erro) {
        if (mostrarErro) {
            alert("Erro ao buscar cotação.");
        }
        console.log("Erro interno:", erro);
    }
}

function atualizarLucroValor(valor) {
    document.getElementById("lucroValor").innerText = valor;
}

function calcular() {
    var valorUsd = parseFloat(document.getElementById("valorUsd").value);
    var peso = parseFloat(document.getElementById("peso").value);
    var cotacao = parseFloat(document.getElementById("cotacao").value);
    var quantidade = parseInt(document.getElementById("quantidade").value) || 1;

    if (!valorUsd || !peso || !cotacao) {
        alert("Preencha todos os campos.");
        return;
    }

    var totalUsd = valorUsd * quantidade;
    var pesoTotal = peso * quantidade;

    var produtoReais = totalUsd * cotacao;
    var paraguay = (pesoTotal / 1000) * 25 * cotacao;
    var freteiro = (produtoReais * 0.25) + 100;
    var custo = produtoReais + paraguay + freteiro;

    var percentual = parseFloat(document.getElementById("lucroSlider").value);
    var lucro = custo * (percentual/100);
    var final = custo + lucro;
    var unitario = final / quantidade;

    var html = "";
    html += "<div><b>Produto Total (" + quantidade + "x):</b> R$ " + produtoReais.toFixed(2) + "</div>";
    html += "<div><b>Peso Total:</b> " + pesoTotal.toFixed(0) + " g</div>";
    html += "<div><b>Paraguay Box:</b> R$ " + paraguay.toFixed(2) + "</div>";
    html += "<div><b>Freteiro:</b> R$ " + freteiro.toFixed(2) + "</div>";
    html += "<div class='valor-destaque'><b>Custo Total:</b> R$ " + custo.toFixed(2) + "</div>";
    html += "<hr>";
    html += "<table class='tabela'>";
    html += "<tr><td><b>%</b></td><td><b>Lucro</b></td><td><b>Total</b></td><td><b>Unitário</b></td></tr>";
    html += "<tr>";
    html += "<td>" + percentual + "%</td>";
    html += "<td>R$ " + lucro.toFixed(2) + "</td>";
    html += "<td class='valor-destaque'>R$ " + final.toFixed(2) +
            " <button class='btn-copy' onclick=\"copiarValor('" + final.toFixed(2) + "')\">Copiar</button></td>";
    html += "<td class='valor-destaque'>R$ " + unitario.toFixed(2) + "</td>";
    html += "</tr>";
    html += "</table>";

    document.getElementById("resultado").style.display = "block";
    document.getElementById("resultado").innerHTML = html;
}

function copiarValor(valor) {
    navigator.clipboard.writeText("R$ " + valor);
    alert("Copiado: R$ " + valor);
}

function alternarModo() {
    document.body.classList.toggle("light-mode");
}

function limparTudo() {
    document.getElementById("valorUsd").value = "";
    document.getElementById("peso").value = "";
    document.getElementById("cotacao").value = "";
    document.getElementById("quantidade").value = "1";
    document.getElementById("lucroSlider").value = "20";
    document.getElementById("lucroValor").innerText = "20";
    document.getElementById("resultado").style.display = "none";
}

window.onload = function() {
    atualizarDolar(false);
};
</script>

</body>
</html>